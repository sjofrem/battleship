(()=>{"use strict";const t=class{constructor(t){this.length=t,this.hits=[]}hit(t){this.hits.includes(t)||t<0||t>=this.length||this.hits.push(t)}isSunk(){return this.hits.length===this.length}},e=10,r=class{constructor(){this.board=[],this.shots=[],this.initialize()}initialize(){for(let t=0;t<e;t++){this.board[t]=[],this.shots[t]=[];for(let r=0;r<e;r++)this.board[t][r]=null,this.shots[t][r]=!1}}placeShip(t,e,r,s){if(!this.isValidPlacement(t,e,r,s))return!1;if(s)for(let s=0;s<t.length;s++)this.board[e+s][r]=t;else for(let s=0;s<t.length;s++)this.board[e][r+s]=t;return!0}placeShipsRandomly(){const e=[],r=new t(5),s=new t(4),a=new t(3),o=new t(3),i=new t(2);e.push(r,s,a,o,i);let d=0;for(;d<5;){const t=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),s=1===Math.floor(2*Math.random());this.placeShip(e[d],t,r,s)&&d++}}getEmptyFields(){let t=0;for(let r=0;r<e;r++)for(let s=0;s<e;s++)null===this.board[r][s]&&t++;return t}isValidPlacement(t,r,s,a){if(r<0||r>9||s<0||s>9)return!1;if(a){if(r+t.length>e)return!1}else if(s+t.length>e)return!1;if(a){for(let e=0;e<t.length;e++)if(this.board[r+e][s])return!1}else for(let e=0;e<t.length;e++)if(this.board[r][s+e])return!1;return!0}receiveAttack(t,e){if(t<0||t>9||e<0||e>9)return!1;if(this.board[t][e]){let r=0;if(t>0&&this.board[t-1][e]===this.board[t][e])for(let s=1;s<t;s++)this.board[t][e]===this.board[s][e]&&r++;else if(e>0&&this.board[t][e-1]===this.board[t][e])for(let s=1;s<e;s++)this.board[t][e]===this.board[t][s]&&r++;return this.board[t][e].hit(r),this.shots[t][e]=!0,!0}return this.shots[t][e]=!0,!1}isGameOver(){for(let t=0;t<e;t++)for(let r=0;r<e;r++)if(this.board[t][r]&&!this.board[t][r].isSunk())return!1;return!0}},s=class{constructor(t){this.name=t,this.hitCoordinates=[]}attack(t,e,r){return null==this.checkCoordinates(t,e)&&(this.hitCoordinates.push([t,e]),r.receiveAttack(t,e),!0)}randomAttack(t){if(100===this.hitCoordinates.length)return!1;let e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),s=this.checkCoordinates(e,r);for(;null!=s;)e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),s=this.checkCoordinates(e,r);return this.hitCoordinates.push([e,r]),t.receiveAttack(e,r),!0}checkCoordinates(t,e){return this.hitCoordinates.find((r=>r[0]===t&&r[1]===e))}};(new class{constructor(){this.cpuBoard=new r,this.playerBoard=new r,this.user=new s("user"),this.cpu=new s("cpu"),this.playerTurn=!0}static createPlayerGameboard(){const t=document.getElementById("game"),e=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),a=["","A","B","C","D","E","F","G","H","I","J"];let o,i;for(e.classList.add("player"),e.setAttribute("id","user"),r.classList.add("playerTag"),r.textContent="Player",e.appendChild(r),s.classList.add("gameboard"),o=0;o<11;o++){const t=document.createElement("div");t.classList.add("coordinate"),t.textContent=a[o],s.appendChild(t)}for(o=0;o<10;o++)for(i=0;i<11;i++)if(0===i){const t=document.createElement("div");t.classList.add("coordinate"),t.textContent=`${o}`,s.appendChild(t)}else{const t=document.createElement("div");t.classList.add("field"),s.appendChild(t)}e.appendChild(s),t.appendChild(e)}createCPUGameboard(){const t=document.getElementById("game"),e=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),a=["","A","B","C","D","E","F","G","H","I","J"];let o,i;for(e.classList.add("player"),e.setAttribute("id","cpu"),r.classList.add("playerTag"),r.classList.add("cpu"),r.textContent="CPU",e.appendChild(r),s.classList.add("gameboard"),o=0;o<11;o++){const t=document.createElement("div");t.classList.add("coordinate"),t.textContent=a[o],s.appendChild(t)}for(o=0;o<10;o++)for(i=0;i<11;i++)if(0===i){const t=document.createElement("div");t.classList.add("coordinate"),t.textContent=`${o}`,s.appendChild(t)}else{const t=document.createElement("div");t.classList.add("cpuField"),s.appendChild(t),t.row=o,t.column=i-1,t.addEventListener("click",(t=>{this.user.attack(t.currentTarget.row,t.currentTarget.column,this.cpuBoard)&&this.playerTurn&&(this.renderCPUGameboard(),this.playerTurn=!1,this.cpuBoard.isGameOver()?(document.querySelector(".instructionsPrompt").textContent="You Won",this.createRetryBtn()):this.CPUAttack())}))}e.appendChild(s),t.appendChild(e)}createRetryBtn(){const t=document.querySelectorAll(".instructionsContainer"),e=document.createElement("button");e.textContent="Retry",e.classList.add("btn"),e.addEventListener("click",(()=>{const t=document.querySelector(".instructionsPrompt"),e=document.getElementById("cpu"),r=document.getElementById("user"),s=document.querySelector(".btn");t.textContent="",e.remove(),r.remove(),s.remove(),this.cpuBoard.board=[],this.cpuBoard.shots=[],this.cpuBoard.initialize(),this.playerBoard.board=[],this.playerBoard.shots=[],this.playerBoard.initialize(),this.playerTurn=!0,this.user.hitCoordinates=[],this.cpu.hitCoordinates=[],this.Game()})),t[1].appendChild(e)}renderBoats(){const t=document.getElementById("user").querySelectorAll(".field");let e=0;for(let r=0;r<10;r++)for(let s=0;s<10;s++)this.playerBoard.board[r][s]&&t[e].classList.add("ship"),e++}renderPlayerGameboard(){const t=document.getElementById("user").querySelectorAll(".field");let e=0;for(let r=0;r<10;r++)for(let s=0;s<10;s++){if(this.playerBoard.board[r][s]&&this.playerBoard.shots[r][s]&&!t[e].querySelector(".shot")){const r=document.createElement("div");r.classList.add("shot"),r.classList.add("hit"),t[e].appendChild(r)}if(this.playerBoard.shots[r][s]&&!t[e].querySelector(".shot")){const r=document.createElement("div");r.classList.add("shot"),r.classList.add("miss"),t[e].appendChild(r)}e++}}renderCPUGameboard(){const t=document.getElementById("cpu").querySelectorAll(".cpuField");let e=0;for(let r=0;r<10;r++)for(let s=0;s<10;s++){if(this.cpuBoard.board[r][s]&&this.cpuBoard.shots[r][s]&&!t[e].querySelector(".shot")){const r=document.createElement("div");r.classList.add("shot"),r.classList.add("hit"),t[e].appendChild(r)}if(this.cpuBoard.shots[r][s]&&!t[e].querySelector(".shot")){const r=document.createElement("div");r.classList.add("shot"),r.classList.add("miss"),t[e].appendChild(r)}e++}}CPUAttack(){this.cpu.randomAttack(this.playerBoard),this.renderPlayerGameboard(),this.playerBoard.isGameOver()?(document.querySelector(".instructionsPrompt").textContent="CPU Won",this.createRetryBtn()):this.playerTurn=!0}Game(){this.cpuBoard.placeShipsRandomly(),this.playerBoard.placeShipsRandomly(),this.constructor.createPlayerGameboard(),this.createCPUGameboard(),this.renderBoats()}}).Game()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0UvRSxLQUFLOEMsU0FBUzNCLHFCQUNkbkIsS0FBSytDLFlBQVk1QixxQkFFakJuQixLQUFLRixZQUFZc0Ysd0JBQ2pCcEYsS0FBS2lFLHFCQUVMakUsS0FBS2dGLGlCRHpPTkQsUSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzL1NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMvR2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvdmlldy9VSS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTaGlwIHtcbiAgY29uc3RydWN0b3IobGVuZ3RoKSB7XG4gICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XG4gICAgdGhpcy5oaXRzID0gW107XG4gIH1cblxuICBoaXQocG9zaXRpb24pIHtcbiAgICBpZiAoXG4gICAgICB0aGlzLmhpdHMuaW5jbHVkZXMocG9zaXRpb24pXG4gICAgICB8fCBwb3NpdGlvbiA8IDBcbiAgICAgIHx8IHBvc2l0aW9uID49IHRoaXMubGVuZ3RoXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaGl0cy5wdXNoKHBvc2l0aW9uKTtcbiAgfVxuXG4gIGlzU3VuaygpIHtcbiAgICByZXR1cm4gdGhpcy5oaXRzLmxlbmd0aCA9PT0gdGhpcy5sZW5ndGg7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU2hpcDtcbiIsImltcG9ydCBTaGlwIGZyb20gJy4vU2hpcCc7XG5cbmNvbnN0IFNJWkUgPSAxMDtcblxuY2xhc3MgR2FtZWJvYXJkIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5ib2FyZCA9IFtdO1xuICAgIHRoaXMuc2hvdHMgPSBbXTtcbiAgICB0aGlzLmluaXRpYWxpemUoKTtcbiAgfVxuXG4gIGluaXRpYWxpemUoKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBTSVpFOyBpKyspIHtcbiAgICAgIHRoaXMuYm9hcmRbaV0gPSBbXTtcbiAgICAgIHRoaXMuc2hvdHNbaV0gPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgU0laRTsgaisrKSB7XG4gICAgICAgIHRoaXMuYm9hcmRbaV1bal0gPSBudWxsO1xuICAgICAgICB0aGlzLnNob3RzW2ldW2pdID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcGxhY2VTaGlwKHNoaXAsIHJvdywgY29sdW1uLCBpc1ZlcnRpY2FsKSB7XG4gICAgaWYgKCF0aGlzLmlzVmFsaWRQbGFjZW1lbnQoc2hpcCwgcm93LCBjb2x1bW4sIGlzVmVydGljYWwpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChpc1ZlcnRpY2FsKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdGhpcy5ib2FyZFtyb3cgKyBpXVtjb2x1bW5dID0gc2hpcDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRoaXMuYm9hcmRbcm93XVtjb2x1bW4gKyBpXSA9IHNoaXA7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcGxhY2VTaGlwc1JhbmRvbWx5KCkge1xuICAgIGNvbnN0IHNoaXBzID0gW107XG4gICAgY29uc3QgY2FycmllciA9IG5ldyBTaGlwKDUpO1xuICAgIGNvbnN0IGJhdHRsZXNoaXAgPSBuZXcgU2hpcCg0KTtcbiAgICBjb25zdCBkZXN0cm95ZXIgPSBuZXcgU2hpcCgzKTtcbiAgICBjb25zdCBzdWJtYXJpbmUgPSBuZXcgU2hpcCgzKTtcbiAgICBjb25zdCBwYXRyb2xCb2F0ID0gbmV3IFNoaXAoMik7XG4gICAgc2hpcHMucHVzaChjYXJyaWVyLCBiYXR0bGVzaGlwLCBkZXN0cm95ZXIsIHN1Ym1hcmluZSwgcGF0cm9sQm9hdCk7XG5cbiAgICBsZXQgc3VjY2VzZnVsUGxhY2VtZXRzID0gMDtcblxuICAgIHdoaWxlIChzdWNjZXNmdWxQbGFjZW1ldHMgPCA1KSB7XG4gICAgICBjb25zdCByb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBjb25zdCBjb2x1bW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBjb25zdCBpc1ZlcnRpY2FsID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgPT09IDE7XG5cbiAgICAgIGlmICh0aGlzLnBsYWNlU2hpcChzaGlwc1tzdWNjZXNmdWxQbGFjZW1ldHNdLCByb3csIGNvbHVtbiwgaXNWZXJ0aWNhbCkpIHtcbiAgICAgICAgc3VjY2VzZnVsUGxhY2VtZXRzKys7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0RW1wdHlGaWVsZHMoKSB7XG4gICAgbGV0IGVtcHR5RmllbGRzID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgU0laRTsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IFNJWkU7IGorKykge1xuICAgICAgICBpZiAodGhpcy5ib2FyZFtpXVtqXSA9PT0gbnVsbCkge1xuICAgICAgICAgIGVtcHR5RmllbGRzKys7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGVtcHR5RmllbGRzO1xuICB9XG5cbiAgaXNWYWxpZFBsYWNlbWVudChzaGlwLCByb3csIGNvbHVtbiwgaXNWZXJ0aWNhbCkge1xuICAgIC8vIGlmIHBsYWNlbWVudCBpcyBvdXQgb2YgZ2FtZWJvYXJkXG4gICAgaWYgKHJvdyA8IDAgfHwgcm93ID4gU0laRSAtIDEgfHwgY29sdW1uIDwgMCB8fCBjb2x1bW4gPiBTSVpFIC0gMSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIHNoaXAgZG9uJ3QgZml0IGluIGdhbWVib2FyZFxuICAgIGlmIChpc1ZlcnRpY2FsKSB7XG4gICAgICBpZiAocm93ICsgc2hpcC5sZW5ndGggPiBTSVpFKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNvbHVtbiArIHNoaXAubGVuZ3RoID4gU0laRSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIGlmIHBsYWNlbWVudCBpcyBhbHJlYWR5IHRha2VuXG4gICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAodGhpcy5ib2FyZFtyb3cgKyBpXVtjb2x1bW5dKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAodGhpcy5ib2FyZFtyb3ddW2NvbHVtbiArIGldKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZWNlaXZlQXR0YWNrKHJvdywgY29sdW1uKSB7XG4gICAgLy8gY2hlY2sgaWYgYXR0YWNrIGlzIHZhbGlkXG4gICAgaWYgKHJvdyA8IDAgfHwgcm93ID4gU0laRSAtIDEgfHwgY29sdW1uIDwgMCB8fCBjb2x1bW4gPiBTSVpFIC0gMSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmJvYXJkW3Jvd11bY29sdW1uXSkge1xuICAgICAgbGV0IGhpdEluZGV4ID0gMDtcbiAgICAgIC8vIGlzIHZlcnRpY2FsXG4gICAgICBpZiAocm93ID4gMCAmJiB0aGlzLmJvYXJkW3JvdyAtIDFdW2NvbHVtbl0gPT09IHRoaXMuYm9hcmRbcm93XVtjb2x1bW5dKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcm93OyBpKyspIHtcbiAgICAgICAgICBpZiAodGhpcy5ib2FyZFtyb3ddW2NvbHVtbl0gPT09IHRoaXMuYm9hcmRbaV1bY29sdW1uXSkge1xuICAgICAgICAgICAgaGl0SW5kZXgrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIC8vIGlzIGhvcml6b250YWxcbiAgICAgIH0gZWxzZSBpZiAoY29sdW1uID4gMCAmJiB0aGlzLmJvYXJkW3Jvd11bY29sdW1uIC0gMV0gPT09IHRoaXMuYm9hcmRbcm93XVtjb2x1bW5dKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgY29sdW1uOyBpKyspIHtcbiAgICAgICAgICBpZiAodGhpcy5ib2FyZFtyb3ddW2NvbHVtbl0gPT09IHRoaXMuYm9hcmRbcm93XVtpXSkge1xuICAgICAgICAgICAgaGl0SW5kZXgrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5ib2FyZFtyb3ddW2NvbHVtbl0uaGl0KGhpdEluZGV4KTtcbiAgICAgIHRoaXMuc2hvdHNbcm93XVtjb2x1bW5dID0gdHJ1ZTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHRoaXMuc2hvdHNbcm93XVtjb2x1bW5dID0gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpc0dhbWVPdmVyKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgU0laRTsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IFNJWkU7IGorKykge1xuICAgICAgICBpZiAodGhpcy5ib2FyZFtpXVtqXSkge1xuICAgICAgICAgIGlmICghdGhpcy5ib2FyZFtpXVtqXS5pc1N1bmsoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBHYW1lYm9hcmQ7XG4iLCJjbGFzcyBQbGF5ZXIge1xuICBjb25zdHJ1Y3RvcihuYW1lKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLmhpdENvb3JkaW5hdGVzID0gW107XG4gIH1cblxuICBhdHRhY2soeCwgeSwgZ2FtZWJvYXJkKSB7XG4gICAgY29uc3QgZmluZENvb3JkaW5hdGVzID0gdGhpcy5jaGVja0Nvb3JkaW5hdGVzKHgsIHkpO1xuICAgIGlmIChmaW5kQ29vcmRpbmF0ZXMgIT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmhpdENvb3JkaW5hdGVzLnB1c2goW3gsIHldKTtcbiAgICBnYW1lYm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJhbmRvbUF0dGFjayhnYW1lYm9hcmQpIHtcbiAgICBpZiAodGhpcy5oaXRDb29yZGluYXRlcy5sZW5ndGggPT09IDEwMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGxldCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIGxldCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIGxldCBmaW5kQ29vcmRpbmF0ZXMgPSB0aGlzLmNoZWNrQ29vcmRpbmF0ZXMoeCwgeSk7XG5cbiAgICB3aGlsZSAoZmluZENvb3JkaW5hdGVzICE9IG51bGwpIHtcbiAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgZmluZENvb3JkaW5hdGVzID0gdGhpcy5jaGVja0Nvb3JkaW5hdGVzKHgsIHkpO1xuICAgIH1cblxuICAgIHRoaXMuaGl0Q29vcmRpbmF0ZXMucHVzaChbeCwgeV0pO1xuICAgIGdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKHgsIHkpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgY2hlY2tDb29yZGluYXRlcyh4LCB5KSB7XG4gICAgcmV0dXJuIHRoaXMuaGl0Q29vcmRpbmF0ZXMuZmluZChcbiAgICAgIChlbGVtZW50KSA9PiBlbGVtZW50WzBdID09PSB4ICYmIGVsZW1lbnRbMV0gPT09IHksXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQbGF5ZXI7XG4iLCJpbXBvcnQgVUkgZnJvbSAnLi92aWV3L1VJJztcblxuY29uc3QgdWkgPSBuZXcgVUkoKTtcblxudWkuR2FtZSgpO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tICcuLi9mYWN0b3JpZXMvR2FtZWJvYXJkJztcbmltcG9ydCBQbGF5ZXIgZnJvbSAnLi4vZmFjdG9yaWVzL1BsYXllcic7XG5cbmNsYXNzIFVJIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jcHVCb2FyZCA9IG5ldyBHYW1lYm9hcmQoKTtcbiAgICB0aGlzLnBsYXllckJvYXJkID0gbmV3IEdhbWVib2FyZCgpO1xuICAgIHRoaXMudXNlciA9IG5ldyBQbGF5ZXIoJ3VzZXInKTtcbiAgICB0aGlzLmNwdSA9IG5ldyBQbGF5ZXIoJ2NwdScpO1xuICAgIHRoaXMucGxheWVyVHVybiA9IHRydWU7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlUGxheWVyR2FtZWJvYXJkKCkge1xuICAgIGNvbnN0IGdhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZScpO1xuICAgIGNvbnN0IHVzZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb25zdCBnYW1lclRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IGdhbWVib2FyZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IGxldHRlcnMgPSBbJycsICdBJywgJ0InLCAnQycsICdEJywgJ0UnLCAnRicsICdHJywgJ0gnLCAnSScsICdKJ107XG4gICAgbGV0IGk7XG4gICAgbGV0IGo7XG5cbiAgICB1c2VyLmNsYXNzTGlzdC5hZGQoJ3BsYXllcicpO1xuICAgIHVzZXIuc2V0QXR0cmlidXRlKCdpZCcsICd1c2VyJyk7XG5cbiAgICBnYW1lclRhZy5jbGFzc0xpc3QuYWRkKCdwbGF5ZXJUYWcnKTtcbiAgICBnYW1lclRhZy50ZXh0Q29udGVudCA9ICdQbGF5ZXInO1xuICAgIHVzZXIuYXBwZW5kQ2hpbGQoZ2FtZXJUYWcpO1xuXG4gICAgZ2FtZWJvYXJkLmNsYXNzTGlzdC5hZGQoJ2dhbWVib2FyZCcpO1xuICAgIGZvciAoaSA9IDA7IGkgPCAxMTsgaSsrKSB7XG4gICAgICBjb25zdCBjb29yZGluYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBjb29yZGluYXRlLmNsYXNzTGlzdC5hZGQoJ2Nvb3JkaW5hdGUnKTtcbiAgICAgIGNvb3JkaW5hdGUudGV4dENvbnRlbnQgPSBsZXR0ZXJzW2ldO1xuICAgICAgZ2FtZWJvYXJkLmFwcGVuZENoaWxkKGNvb3JkaW5hdGUpO1xuICAgIH1cblxuICAgIGZvciAoaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBmb3IgKGogPSAwOyBqIDwgMTE7IGorKykge1xuICAgICAgICBpZiAoaiA9PT0gMCkge1xuICAgICAgICAgIGNvbnN0IGNvb3JkaW5hdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICBjb29yZGluYXRlLmNsYXNzTGlzdC5hZGQoJ2Nvb3JkaW5hdGUnKTtcbiAgICAgICAgICBjb29yZGluYXRlLnRleHRDb250ZW50ID0gYCR7aX1gO1xuICAgICAgICAgIGdhbWVib2FyZC5hcHBlbmRDaGlsZChjb29yZGluYXRlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgIGZpZWxkLmNsYXNzTGlzdC5hZGQoJ2ZpZWxkJyk7XG4gICAgICAgICAgZ2FtZWJvYXJkLmFwcGVuZENoaWxkKGZpZWxkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHVzZXIuYXBwZW5kQ2hpbGQoZ2FtZWJvYXJkKTtcbiAgICBnYW1lLmFwcGVuZENoaWxkKHVzZXIpO1xuICB9XG5cbiAgY3JlYXRlQ1BVR2FtZWJvYXJkKCkge1xuICAgIGNvbnN0IGdhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZScpO1xuICAgIGNvbnN0IHVzZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb25zdCBnYW1lclRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IGdhbWVib2FyZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IGxldHRlcnMgPSBbJycsICdBJywgJ0InLCAnQycsICdEJywgJ0UnLCAnRicsICdHJywgJ0gnLCAnSScsICdKJ107XG4gICAgbGV0IGk7XG4gICAgbGV0IGo7XG5cbiAgICB1c2VyLmNsYXNzTGlzdC5hZGQoJ3BsYXllcicpO1xuICAgIHVzZXIuc2V0QXR0cmlidXRlKCdpZCcsICdjcHUnKTtcblxuICAgIGdhbWVyVGFnLmNsYXNzTGlzdC5hZGQoJ3BsYXllclRhZycpO1xuICAgIGdhbWVyVGFnLmNsYXNzTGlzdC5hZGQoJ2NwdScpO1xuICAgIGdhbWVyVGFnLnRleHRDb250ZW50ID0gJ0NQVSc7XG4gICAgdXNlci5hcHBlbmRDaGlsZChnYW1lclRhZyk7XG5cbiAgICBnYW1lYm9hcmQuY2xhc3NMaXN0LmFkZCgnZ2FtZWJvYXJkJyk7XG4gICAgZm9yIChpID0gMDsgaSA8IDExOyBpKyspIHtcbiAgICAgIGNvbnN0IGNvb3JkaW5hdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGNvb3JkaW5hdGUuY2xhc3NMaXN0LmFkZCgnY29vcmRpbmF0ZScpO1xuICAgICAgY29vcmRpbmF0ZS50ZXh0Q29udGVudCA9IGxldHRlcnNbaV07XG4gICAgICBnYW1lYm9hcmQuYXBwZW5kQ2hpbGQoY29vcmRpbmF0ZSk7XG4gICAgfVxuXG4gICAgZm9yIChpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIGZvciAoaiA9IDA7IGogPCAxMTsgaisrKSB7XG4gICAgICAgIGlmIChqID09PSAwKSB7XG4gICAgICAgICAgY29uc3QgY29vcmRpbmF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgIGNvb3JkaW5hdGUuY2xhc3NMaXN0LmFkZCgnY29vcmRpbmF0ZScpO1xuICAgICAgICAgIGNvb3JkaW5hdGUudGV4dENvbnRlbnQgPSBgJHtpfWA7XG4gICAgICAgICAgZ2FtZWJvYXJkLmFwcGVuZENoaWxkKGNvb3JkaW5hdGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgZmllbGQuY2xhc3NMaXN0LmFkZCgnY3B1RmllbGQnKTtcbiAgICAgICAgICBnYW1lYm9hcmQuYXBwZW5kQ2hpbGQoZmllbGQpO1xuICAgICAgICAgIGZpZWxkLnJvdyA9IGk7XG4gICAgICAgICAgZmllbGQuY29sdW1uID0gaiAtIDE7XG4gICAgICAgICAgZmllbGQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy51c2VyLmF0dGFjayhcbiAgICAgICAgICAgICAgZXZ0LmN1cnJlbnRUYXJnZXQucm93LFxuICAgICAgICAgICAgICBldnQuY3VycmVudFRhcmdldC5jb2x1bW4sXG4gICAgICAgICAgICAgIHRoaXMuY3B1Qm9hcmQsXG4gICAgICAgICAgICApICYmIHRoaXMucGxheWVyVHVyblxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMucmVuZGVyQ1BVR2FtZWJvYXJkKCk7XG4gICAgICAgICAgICAgIHRoaXMucGxheWVyVHVybiA9IGZhbHNlO1xuICAgICAgICAgICAgICBpZiAodGhpcy5jcHVCb2FyZC5pc0dhbWVPdmVyKCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0RGlzcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnN0cnVjdGlvbnNQcm9tcHQnKTtcbiAgICAgICAgICAgICAgICB0ZXh0RGlzcGxheS50ZXh0Q29udGVudCA9ICdZb3UgV29uJztcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVJldHJ5QnRuKCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5DUFVBdHRhY2soKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHVzZXIuYXBwZW5kQ2hpbGQoZ2FtZWJvYXJkKTtcbiAgICBnYW1lLmFwcGVuZENoaWxkKHVzZXIpO1xuICB9XG5cbiAgY3JlYXRlUmV0cnlCdG4oKSB7XG4gICAgY29uc3QgaW5zdHJ1Y3Rpb25Db250YWluZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmluc3RydWN0aW9uc0NvbnRhaW5lcicpO1xuICAgIGNvbnN0IHJldHJ5QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgcmV0cnlCdG4udGV4dENvbnRlbnQgPSAnUmV0cnknO1xuICAgIHJldHJ5QnRuLmNsYXNzTGlzdC5hZGQoJ2J0bicpO1xuICAgIHJldHJ5QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgY29uc3QgZ2FtZU1zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnN0cnVjdGlvbnNQcm9tcHQnKTtcbiAgICAgIGNvbnN0IGNwdSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcHUnKTtcbiAgICAgIGNvbnN0IHVzZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcicpO1xuICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ0bicpO1xuICAgICAgZ2FtZU1zZy50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgY3B1LnJlbW92ZSgpO1xuICAgICAgdXNlci5yZW1vdmUoKTtcbiAgICAgIGJ0bi5yZW1vdmUoKTtcbiAgICAgIHRoaXMuY3B1Qm9hcmQuYm9hcmQgPSBbXTtcbiAgICAgIHRoaXMuY3B1Qm9hcmQuc2hvdHMgPSBbXTtcbiAgICAgIHRoaXMuY3B1Qm9hcmQuaW5pdGlhbGl6ZSgpO1xuICAgICAgdGhpcy5wbGF5ZXJCb2FyZC5ib2FyZCA9IFtdO1xuICAgICAgdGhpcy5wbGF5ZXJCb2FyZC5zaG90cyA9IFtdO1xuICAgICAgdGhpcy5wbGF5ZXJCb2FyZC5pbml0aWFsaXplKCk7XG4gICAgICB0aGlzLnBsYXllclR1cm4gPSB0cnVlO1xuICAgICAgdGhpcy51c2VyLmhpdENvb3JkaW5hdGVzID0gW107XG4gICAgICB0aGlzLmNwdS5oaXRDb29yZGluYXRlcyA9IFtdO1xuICAgICAgdGhpcy5HYW1lKCk7XG4gICAgfSk7XG4gICAgaW5zdHJ1Y3Rpb25Db250YWluZXJzWzFdLmFwcGVuZENoaWxkKHJldHJ5QnRuKTtcbiAgfVxuXG4gIHJlbmRlckJvYXRzKCkge1xuICAgIGNvbnN0IHVzZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcicpO1xuICAgIGNvbnN0IGJvYXJkID0gdXNlci5xdWVyeVNlbGVjdG9yQWxsKCcuZmllbGQnKTtcbiAgICBsZXQgZmllbGRDb3VudGVyID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxMDsgaisrKSB7XG4gICAgICAgIGlmICh0aGlzLnBsYXllckJvYXJkLmJvYXJkW2ldW2pdKSB7XG4gICAgICAgICAgYm9hcmRbZmllbGRDb3VudGVyXS5jbGFzc0xpc3QuYWRkKCdzaGlwJyk7XG4gICAgICAgIH1cblxuICAgICAgICBmaWVsZENvdW50ZXIrKztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZW5kZXJQbGF5ZXJHYW1lYm9hcmQoKSB7XG4gICAgY29uc3QgdXNlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyJyk7XG4gICAgY29uc3QgYm9hcmQgPSB1c2VyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWVsZCcpO1xuICAgIGxldCBmaWVsZENvdW50ZXIgPSAwO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgaWYgKHRoaXMucGxheWVyQm9hcmQuYm9hcmRbaV1bal1cbiAgICAgICAgICAmJiB0aGlzLnBsYXllckJvYXJkLnNob3RzW2ldW2pdXG4gICAgICAgICAgJiYgIWJvYXJkW2ZpZWxkQ291bnRlcl0ucXVlcnlTZWxlY3RvcignLnNob3QnKSkge1xuICAgICAgICAgIGNvbnN0IHNob3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICBzaG90LmNsYXNzTGlzdC5hZGQoJ3Nob3QnKTtcbiAgICAgICAgICBzaG90LmNsYXNzTGlzdC5hZGQoJ2hpdCcpO1xuICAgICAgICAgIGJvYXJkW2ZpZWxkQ291bnRlcl0uYXBwZW5kQ2hpbGQoc2hvdCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucGxheWVyQm9hcmQuc2hvdHNbaV1bal1cbiAgICAgICAgICAmJiAhYm9hcmRbZmllbGRDb3VudGVyXS5xdWVyeVNlbGVjdG9yKCcuc2hvdCcpKSB7XG4gICAgICAgICAgY29uc3Qgc2hvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgIHNob3QuY2xhc3NMaXN0LmFkZCgnc2hvdCcpO1xuICAgICAgICAgIHNob3QuY2xhc3NMaXN0LmFkZCgnbWlzcycpO1xuICAgICAgICAgIGJvYXJkW2ZpZWxkQ291bnRlcl0uYXBwZW5kQ2hpbGQoc2hvdCk7XG4gICAgICAgIH1cblxuICAgICAgICBmaWVsZENvdW50ZXIrKztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZW5kZXJDUFVHYW1lYm9hcmQoKSB7XG4gICAgY29uc3QgY3B1ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NwdScpO1xuICAgIGNvbnN0IGJvYXJkID0gY3B1LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jcHVGaWVsZCcpO1xuICAgIGxldCBmaWVsZENvdW50ZXIgPSAwO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgaWYgKHRoaXMuY3B1Qm9hcmQuYm9hcmRbaV1bal1cbiAgICAgICAgICAmJiB0aGlzLmNwdUJvYXJkLnNob3RzW2ldW2pdXG4gICAgICAgICAgJiYgIWJvYXJkW2ZpZWxkQ291bnRlcl0ucXVlcnlTZWxlY3RvcignLnNob3QnKSkge1xuICAgICAgICAgIGNvbnN0IHNob3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICBzaG90LmNsYXNzTGlzdC5hZGQoJ3Nob3QnKTtcbiAgICAgICAgICBzaG90LmNsYXNzTGlzdC5hZGQoJ2hpdCcpO1xuICAgICAgICAgIGJvYXJkW2ZpZWxkQ291bnRlcl0uYXBwZW5kQ2hpbGQoc2hvdCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY3B1Qm9hcmQuc2hvdHNbaV1bal1cbiAgICAgICAgICAmJiAhYm9hcmRbZmllbGRDb3VudGVyXS5xdWVyeVNlbGVjdG9yKCcuc2hvdCcpKSB7XG4gICAgICAgICAgY29uc3Qgc2hvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgIHNob3QuY2xhc3NMaXN0LmFkZCgnc2hvdCcpO1xuICAgICAgICAgIHNob3QuY2xhc3NMaXN0LmFkZCgnbWlzcycpO1xuICAgICAgICAgIGJvYXJkW2ZpZWxkQ291bnRlcl0uYXBwZW5kQ2hpbGQoc2hvdCk7XG4gICAgICAgIH1cblxuICAgICAgICBmaWVsZENvdW50ZXIrKztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBDUFVBdHRhY2soKSB7XG4gICAgdGhpcy5jcHUucmFuZG9tQXR0YWNrKHRoaXMucGxheWVyQm9hcmQpO1xuICAgIHRoaXMucmVuZGVyUGxheWVyR2FtZWJvYXJkKCk7XG4gICAgaWYgKHRoaXMucGxheWVyQm9hcmQuaXNHYW1lT3ZlcigpKSB7XG4gICAgICBjb25zdCB0ZXh0RGlzcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnN0cnVjdGlvbnNQcm9tcHQnKTtcbiAgICAgIHRleHREaXNwbGF5LnRleHRDb250ZW50ID0gJ0NQVSBXb24nO1xuICAgICAgdGhpcy5jcmVhdGVSZXRyeUJ0bigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBsYXllclR1cm4gPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIEdhbWUoKSB7XG4gICAgdGhpcy5jcHVCb2FyZC5wbGFjZVNoaXBzUmFuZG9tbHkoKTtcbiAgICB0aGlzLnBsYXllckJvYXJkLnBsYWNlU2hpcHNSYW5kb21seSgpO1xuXG4gICAgdGhpcy5jb25zdHJ1Y3Rvci5jcmVhdGVQbGF5ZXJHYW1lYm9hcmQoKTtcbiAgICB0aGlzLmNyZWF0ZUNQVUdhbWVib2FyZCgpO1xuXG4gICAgdGhpcy5yZW5kZXJCb2F0cygpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFVJO1xuIl0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwibGVuZ3RoIiwidGhpcyIsImhpdHMiLCJoaXQiLCJwb3NpdGlvbiIsImluY2x1ZGVzIiwicHVzaCIsImlzU3VuayIsIlNJWkUiLCJib2FyZCIsInNob3RzIiwiaW5pdGlhbGl6ZSIsImkiLCJqIiwicGxhY2VTaGlwIiwic2hpcCIsInJvdyIsImNvbHVtbiIsImlzVmVydGljYWwiLCJpc1ZhbGlkUGxhY2VtZW50IiwicGxhY2VTaGlwc1JhbmRvbWx5Iiwic2hpcHMiLCJjYXJyaWVyIiwiYmF0dGxlc2hpcCIsImRlc3Ryb3llciIsInN1Ym1hcmluZSIsInBhdHJvbEJvYXQiLCJzdWNjZXNmdWxQbGFjZW1ldHMiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJnZXRFbXB0eUZpZWxkcyIsImVtcHR5RmllbGRzIiwicmVjZWl2ZUF0dGFjayIsImhpdEluZGV4IiwiaXNHYW1lT3ZlciIsIm5hbWUiLCJoaXRDb29yZGluYXRlcyIsImF0dGFjayIsIngiLCJ5IiwiZ2FtZWJvYXJkIiwiY2hlY2tDb29yZGluYXRlcyIsInJhbmRvbUF0dGFjayIsImZpbmRDb29yZGluYXRlcyIsImZpbmQiLCJlbGVtZW50IiwiY3B1Qm9hcmQiLCJwbGF5ZXJCb2FyZCIsInVzZXIiLCJjcHUiLCJwbGF5ZXJUdXJuIiwic3RhdGljIiwiZ2FtZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjcmVhdGVFbGVtZW50IiwiZ2FtZXJUYWciLCJsZXR0ZXJzIiwiY2xhc3NMaXN0IiwiYWRkIiwic2V0QXR0cmlidXRlIiwidGV4dENvbnRlbnQiLCJhcHBlbmRDaGlsZCIsImNvb3JkaW5hdGUiLCJmaWVsZCIsImNyZWF0ZUNQVUdhbWVib2FyZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJjdXJyZW50VGFyZ2V0IiwicmVuZGVyQ1BVR2FtZWJvYXJkIiwicXVlcnlTZWxlY3RvciIsImNyZWF0ZVJldHJ5QnRuIiwiQ1BVQXR0YWNrIiwiaW5zdHJ1Y3Rpb25Db250YWluZXJzIiwicXVlcnlTZWxlY3RvckFsbCIsInJldHJ5QnRuIiwiZ2FtZU1zZyIsImJ0biIsInJlbW92ZSIsIkdhbWUiLCJyZW5kZXJCb2F0cyIsImZpZWxkQ291bnRlciIsInJlbmRlclBsYXllckdhbWVib2FyZCIsInNob3QiLCJjcmVhdGVQbGF5ZXJHYW1lYm9hcmQiXSwic291cmNlUm9vdCI6IiJ9